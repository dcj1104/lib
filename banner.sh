#!/bin/sh
# å®‰è£…ç™»å½•åŽæ˜¾ç¤ºçš„å½©è‰² Bannerï¼ˆä»…æ˜¾ç¤º /etc/bannerï¼Œç¦ç”¨ MOTDï¼‰
BANNER_FILE="/etc/banner"
PROFILE_FILE="/etc/profile"

# 1) å¦‚æžœ /etc/banner ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶ï¼ˆå†™å…¥ç¤ºä¾‹ Bannerï¼Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ï¼‰
if [ ! -f "$BANNER_FILE" ]; then
cat > "$BANNER_FILE" <<'EOF'
[0;1;31;91mâ–„[0m    [0;1;36;96mâ–„[0m                                          
[0;1;33;93mâ–ˆ[0;1;32;92mâ–ˆ[0m  [0;1;36;96mâ–ˆ[0;1;34;94mâ–ˆ[0m  [0;1;35;95mâ–„[0;1;31;91mâ–„â–„[0m    [0;1;36;96mâ–„[0m [0;1;34;94mâ–„â–„[0m   [0;1;31;91mâ–„[0;1;33;93mâ–„â–„[0m    [0;1;34;94mâ–„â–„[0;1;35;95mâ–„[0m   [0;1;33;93mâ–„[0m [0;1;32;92mâ–„â–„[0m   [0;1;34;94mâ–„[0;1;35;95mâ–„â–„[0;1;31;91mâ–„[0m  
[0;1;32;92mâ–ˆ[0m [0;1;36;96mâ–ˆ[0;1;34;94mâ–ˆ[0m [0;1;35;95mâ–ˆ[0m [0;1;31;91mâ–ˆâ–€[0m [0;1;33;93mâ–€[0;1;32;92mâ–ˆ[0m   [0;1;34;94mâ–ˆâ–€[0m  [0;1;31;91mâ–€[0m [0;1;33;93mâ–ˆâ–€[0m  [0;1;36;96mâ–ˆ[0m  [0;1;34;94mâ–€[0m   [0;1;31;91mâ–ˆ[0m  [0;1;32;92mâ–ˆâ–€[0m  [0;1;34;94mâ–ˆ[0m  [0;1;35;95mâ–ˆ[0;1;31;91mâ–€[0m [0;1;33;93mâ–€â–ˆ[0m 
[0;1;36;96mâ–ˆ[0m [0;1;34;94mâ–€[0;1;35;95mâ–€[0m [0;1;31;91mâ–ˆ[0m [0;1;33;93mâ–ˆ[0m   [0;1;36;96mâ–ˆ[0m   [0;1;35;95mâ–ˆ[0m     [0;1;32;92mâ–ˆâ–€[0;1;36;96mâ–€â–€[0;1;34;94mâ–€[0m  [0;1;35;95mâ–„[0;1;31;91mâ–€â–€[0;1;33;93mâ–€â–ˆ[0m  [0;1;36;96mâ–ˆ[0m   [0;1;35;95mâ–ˆ[0m  [0;1;31;91mâ–ˆ[0m   [0;1;32;92mâ–ˆ[0m 
[0;1;34;94mâ–ˆ[0m    [0;1;33;93mâ–ˆ[0m [0;1;32;92mâ–€â–ˆ[0;1;36;96mâ–„â–ˆ[0;1;34;94mâ–€[0m   [0;1;31;91mâ–ˆ[0m     [0;1;36;96mâ–€â–ˆ[0;1;34;94mâ–„â–„[0;1;35;95mâ–€[0m  [0;1;31;91mâ–€[0;1;33;93mâ–„â–„[0;1;32;92mâ–€â–ˆ[0m  [0;1;34;94mâ–ˆ[0m   [0;1;31;91mâ–ˆ[0m  [0;1;33;93mâ–ˆ[0;1;32;92mâ–ˆâ–„[0;1;36;96mâ–ˆâ–€[0m 
                                           [0;1;32;92mâ–ˆ[0m     
                                           [0;1;36;96mâ–€[0m     
                                             
                                  Powered by Moreanp    
 -------------------------------------------------------
 Moreanp 2024120615
 -------------------------------------------------------
EOF
fi

# 2) åœ¨ /etc/profile æ·»åŠ è°ƒç”¨é€»è¾‘ï¼ˆé¿å…é‡å¤è¿½åŠ ï¼‰
if ! grep -q '### SHOW /etc/banner ###' "$PROFILE_FILE" 2>/dev/null; then
cat >> "$PROFILE_FILE" <<'EOF'

### SHOW /etc/banner ###
# ä»…äº¤äº’å¼ shell æ‰æ˜¾ç¤º
if [ -n "$PS1" ]; then
    [ -f /etc/banner ] && cat /etc/banner
fi
### END SHOW /etc/banner ###

EOF
fi

# 3) ç¦ç”¨ MOTDï¼ˆUbuntu ç‰¹æœ‰ï¼‰
# æ³¨é‡Š pam_motd è°ƒç”¨
if [ -f /etc/pam.d/sshd ]; then
    sed -i 's/^\(session\s\+optional\s\+pam_motd.so.*\)$/# \1/' /etc/pam.d/sshd
fi
if [ -f /etc/pam.d/login ]; then
    sed -i 's/^\(session\s\+optional\s\+pam_motd.so.*\)$/# \1/' /etc/pam.d/login
fi

# ç¦ç”¨ update-motd.d è„šæœ¬æ‰§è¡Œæƒé™
if [ -d /etc/update-motd.d ]; then
    chmod -x /etc/update-motd.d/*
fi

echo "âœ…å½©è‰²Bannerå·²é…ç½®å®Œæˆï¼ˆå·²å±è”½ Ubuntu MOTDï¼‰"
