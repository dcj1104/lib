#!/bin/sh
# 安装登录后显示的彩色 Banner（仅显示 /etc/banner，禁用 MOTD）
BANNER_FILE="/etc/banner"
PROFILE_FILE="/etc/profile"

# 1) 如果 /etc/banner 不存在，创建文件（写入示例 Banner，可替换为你自己的）
if [ ! -f "$BANNER_FILE" ]; then
cat > "$BANNER_FILE" <<'EOF'
[0;1;31;91m▄[0m    [0;1;36;96m▄[0m                                          
[0;1;33;93m█[0;1;32;92m█[0m  [0;1;36;96m█[0;1;34;94m█[0m  [0;1;35;95m▄[0;1;31;91m▄▄[0m    [0;1;36;96m▄[0m [0;1;34;94m▄▄[0m   [0;1;31;91m▄[0;1;33;93m▄▄[0m    [0;1;34;94m▄▄[0;1;35;95m▄[0m   [0;1;33;93m▄[0m [0;1;32;92m▄▄[0m   [0;1;34;94m▄[0;1;35;95m▄▄[0;1;31;91m▄[0m  
[0;1;32;92m█[0m [0;1;36;96m█[0;1;34;94m█[0m [0;1;35;95m█[0m [0;1;31;91m█▀[0m [0;1;33;93m▀[0;1;32;92m█[0m   [0;1;34;94m█▀[0m  [0;1;31;91m▀[0m [0;1;33;93m█▀[0m  [0;1;36;96m█[0m  [0;1;34;94m▀[0m   [0;1;31;91m█[0m  [0;1;32;92m█▀[0m  [0;1;34;94m█[0m  [0;1;35;95m█[0;1;31;91m▀[0m [0;1;33;93m▀█[0m 
[0;1;36;96m█[0m [0;1;34;94m▀[0;1;35;95m▀[0m [0;1;31;91m█[0m [0;1;33;93m█[0m   [0;1;36;96m█[0m   [0;1;35;95m█[0m     [0;1;32;92m█▀[0;1;36;96m▀▀[0;1;34;94m▀[0m  [0;1;35;95m▄[0;1;31;91m▀▀[0;1;33;93m▀█[0m  [0;1;36;96m█[0m   [0;1;35;95m█[0m  [0;1;31;91m█[0m   [0;1;32;92m█[0m 
[0;1;34;94m█[0m    [0;1;33;93m█[0m [0;1;32;92m▀█[0;1;36;96m▄█[0;1;34;94m▀[0m   [0;1;31;91m█[0m     [0;1;36;96m▀█[0;1;34;94m▄▄[0;1;35;95m▀[0m  [0;1;31;91m▀[0;1;33;93m▄▄[0;1;32;92m▀█[0m  [0;1;34;94m█[0m   [0;1;31;91m█[0m  [0;1;33;93m█[0;1;32;92m█▄[0;1;36;96m█▀[0m 
                                           [0;1;32;92m█[0m     
                                           [0;1;36;96m▀[0m     
                                             
                                  Powered by Moreanp    
 -------------------------------------------------------
 Moreanp 2024120615
 -------------------------------------------------------
EOF
fi

# 2) 在 /etc/profile 添加调用逻辑（避免重复追加）
if ! grep -q '### SHOW /etc/banner ###' "$PROFILE_FILE" 2>/dev/null; then
cat >> "$PROFILE_FILE" <<'EOF'

### SHOW /etc/banner ###
# 仅交互式 shell 才显示
if [ -n "$PS1" ]; then
    [ -f /etc/banner ] && cat /etc/banner
fi
### END SHOW /etc/banner ###

EOF
fi

# 3) 禁用 MOTD（Ubuntu 特有）
# 注释 pam_motd 调用
if [ -f /etc/pam.d/sshd ]; then
    sed -i 's/^\(session\s\+optional\s\+pam_motd.so.*\)$/# \1/' /etc/pam.d/sshd
fi
if [ -f /etc/pam.d/login ]; then
    sed -i 's/^\(session\s\+optional\s\+pam_motd.so.*\)$/# \1/' /etc/pam.d/login
fi

# 禁用 update-motd.d 脚本执行权限
if [ -d /etc/update-motd.d ]; then
    chmod -x /etc/update-motd.d/*
fi

echo "✅彩色Banner已配置完成（已屏蔽 Ubuntu MOTD）"
